import{r as d,j as a,t as ae,D as V,A as se,B as P,v as y,w as K,W as le,x as te,q as H,C as N,y as _,b as A,z as ne,c as $,d as I,E as ie,F as G,I as oe,u as re,G as de,J as ce,p as he,K as me,N as pe,O as xe,H as ue}from"./index-TKpjailX.js";import{D as Y,T as ge,a as f,C as be,F as je,b as O,c as L,u as Se,g as ve,r as fe,d as we,e as Te,f as ye,h as Pe,i as Ae,j as Ne,k as De,l as ke,m as Fe}from"./filters-result-CBl1swIj.js";import{s as Oe,S as Le,M as Re,C as Ie,a as Ee}from"./Snackbar-oRTX2Wpt.js";import{z as h,i as _e,u as ze,t as Ue,a as We,D as q,F as m,C as Be,b as Q,L as Ge,c as X,d as J,e as Me,I as Ve,S as Ke,O as He,T as $e,f as R,g as Ye,h as qe}from"./form-provider-BoU6K9RY.js";let M=!1;const Qe=()=>{M||(console.warn(["MUI: The AdapterDateFns class was moved from `@mui/lab` to `@mui/x-date-pickers`","","You should use `import { AdapterDateFns } from '@mui/x-date-pickers/AdapterDateFns'`","","More information about this migration on our blog: https://mui.com/blog/lab-date-pickers-to-mui-x/."].join(`
`)),M=!0)};class Xe{constructor(){Qe()}}const Je=h.object({customerFirstName:h.string().min(1,{message:"İsim zorunludur!"}),customerLastName:h.string().min(1,{message:"Soyisim zorunludur!"}),phoneNumber:Oe.phoneNumber({isValidPhoneNumber:_e}),emailAddress:h.string().email({message:"Geçerli bir e-posta girin!"}),address:h.string().min(1,{message:"Adres zorunludur!"}),productName:h.string().min(1,{message:"Ürün adı zorunludur!"}),faultDescription:h.string().optional(),faultDate:h.string().optional(),servicePersonnel:h.string().optional(),serviceCompletionStatus:h.string().optional(),operationPerformed:h.string().optional(),warrantyStatus:h.string().optional(),cargoStatus:h.string().optional(),operationDate:h.string().optional(),deliveryDate:h.string().optional(),notes:h.string().optional()});function Ze({currentCustomer:e,open:t,onClose:o,fetchData:p,userNamesFromQuick:u,operationPerformedList:j}){const i=d.useMemo(()=>({id:(e==null?void 0:e.id)||"",customerFirstName:(e==null?void 0:e.customerFirstName)||"",customerLastName:(e==null?void 0:e.customerLastName)||"",phoneNumber:(e==null?void 0:e.phoneNumber)||"",emailAddress:(e==null?void 0:e.emailAddress)||"",address:(e==null?void 0:e.address)||"",productName:(e==null?void 0:e.productName)||"",faultDescription:(e==null?void 0:e.faultDescription)||"",faultDate:(e==null?void 0:e.faultDate)||"",servicePersonnel:(e==null?void 0:e.servicePersonnel)||"",serviceCompletionStatus:(e==null?void 0:e.serviceCompletionStatus)||"",operationPerformed:(e==null?void 0:e.operationPerformed)||"",operationDate:(e==null?void 0:e.operationDate)||"",warrantyStatus:(e==null?void 0:e.warrantyStatus)||"",cargoStatus:(e==null?void 0:e.cargoStatus)||"",deliveryDate:(e==null?void 0:e.deliveryDate)||"",notes:(e==null?void 0:e.notes)||""}),[e]),s=ze({resolver:Ue(Je),defaultValues:i}),{handleSubmit:r}=s,{reset:c,control:x,formState:{isSubmitting:D},watch:k}=s,[z,l]=d.useState(!1),g=k("servicePersonnel"),[F,U]=d.useState(""),[Z,W]=d.useState("success"),C=n=>{const v=["customerLastName","customerFirstName","emailAddress","address","productName","faultDate"],b=Object.keys(n).filter(S=>!v.includes(S)).reduce((S,B)=>(S[B]=n[B],S),{});v.forEach(S=>{e[S]&&(b[S]=e[S])});const ee=`${N.customerUpdateUrl}${e.id}`;_.put(ee,b).then(S=>{U("Güncelleme işlemi başarılı!"),W("success"),l(!0),p(),o()}).catch(S=>{console.error("Güncelleme işleminde hata oluştu:",S),U("Güncelleme işleminde hata oluştu!"),W("error"),l(!0)})};return a.jsx(ae,{dateAdapter:Xe,children:a.jsxs(V,{fullWidth:!0,maxWidth:!1,open:t,onClose:o,PaperProps:{sx:{maxWidth:720}},children:[a.jsxs(We,{methods:s,onSubmit:r(C),children:[a.jsx(Y,{children:"Müşteri Teknik Servis Bilgilerini Güncelle"}),a.jsxs(q,{children:[a.jsx(se,{variant:"outlined",severity:"info",sx:{mb:3},children:"Bilgileri girdikten sonra güncelle butonuna basınız"}),a.jsxs(P,{rowGap:3,columnGap:2,display:"grid",gridTemplateColumns:{xs:"repeat(1, 1fr)",sm:"repeat(2, 1fr)"},children:[a.jsx(m.Text,{name:"customerFirstName",label:"Ad",readOnly:!0}),a.jsx(m.Text,{name:"customerLastName",label:"Soyad",readOnly:!0}),a.jsx(m.Text,{name:"phoneNumber",label:"Telefon"}),a.jsx(m.Text,{name:"emailAddress",label:"E-posta"}),a.jsx(m.Text,{name:"address",label:"Adres",readOnly:!0,multiline:!0,rows:1,fullWidth:!0,sx:{gridColumn:"span 2"}}),a.jsx(m.Text,{name:"productName",label:"Ürün Adı"}),a.jsx(m.DatePicker,{name:"faultDate",label:"Arıza Tarihi",readOnly:!0}),a.jsx(m.Text,{name:"faultDescription",label:"Arıza Tanımı",multiline:!0,rows:1,fullWidth:!0,sx:{gridColumn:"span 2"}}),a.jsx(m.Select,{name:"servicePersonnel",label:"Servis Personeli",value:u.includes(g)?g:"",children:u.map(n=>a.jsx(y,{value:n,children:n},n))}),a.jsx(m.Select,{name:"serviceCompletionStatus",label:"Servis Durumu",children:K.map(n=>a.jsx(y,{value:n.value,children:n.label},n.value))}),a.jsx(Be,{name:"operationPerformed",control:x,defaultValue:i.operationPerformed||"",render:({field:n})=>a.jsx(m.Autocomplete,{...n,label:"Yapılan İşlem",sx:{gridColumn:"span 2"},fullWidth:!0,disableCloseOnSelect:!0,options:Array.isArray(j)?j:[],value:n.value||"",getOptionLabel:v=>typeof v=="string"?v:"",renderOption:(v,b)=>d.createElement("li",{...v,key:b},b),freeSolo:!0,onInputChange:(v,b)=>{n.onChange(b)},onChange:(v,b)=>{typeof b=="string"?n.onChange(b):b&&typeof b=="object"?n.onChange(b.label||b):n.onChange("")}})}),a.jsx(m.Select,{name:"warrantyStatus",label:"Garanti Durumu",children:le.map(n=>a.jsx(y,{value:n.value,children:n.label},n.value))}),a.jsx(m.Select,{name:"cargoStatus",label:"Kargo Durumu",children:te.map(n=>a.jsx(y,{value:n.value,children:n.label},n.value))}),a.jsx(m.DatePicker,{name:"operationDate",label:"İşlem Tarihi"}),a.jsx(m.DatePicker,{name:"deliveryDate",label:"Teslim Tarihi"})]}),a.jsx(P,{mt:3,children:a.jsx(m.Text,{name:"notes",label:"Notlar",multiline:!0,rows:2,fullWidth:!0})})]}),a.jsxs(Q,{children:[a.jsx(H,{variant:"outlined",onClick:o,children:"İptal"}),a.jsx(Ge,{type:"submit",variant:"contained",tabIndex:-1,children:"Güncelle"})]})]}),a.jsx(Le,{open:t,autoHideDuration:6e3,children:a.jsx(Re,{severity:Z,sx:{width:"100%"},children:F})})]})})}function T(e){const o=document.createElement("canvas").getContext("2d");return o.font="16px Arial",o.measureText(e).width}function Ce({row:e,selected:t,onEditRow:o,onSelectRow:p,userNames:u,fetchData:j,operationPerformedList:i}){A();const s=A(),r=A();return X(),a.jsxs(a.Fragment,{children:[a.jsxs(ge,{hover:!0,selected:t,"aria-checked":t,tabIndex:-1,children:[a.jsx(f,{padding:"checkbox",children:a.jsx(J,{id:e.id.toString(),checked:t,onClick:p})}),a.jsx(f,{onDoubleClick:s.onTrue,style:{width:T(e.id)},sx:{whiteSpace:"nowrap"},children:e.id}),a.jsx(f,{onDoubleClick:s.onTrue,style:{width:T(e.customerFirstName)},sx:{whiteSpace:"nowrap"},children:e.customerFirstName}),a.jsx(f,{onDoubleClick:s.onTrue,style:{width:T(e.customerLastName)},sx:{whiteSpace:"nowrap"},children:e.customerLastName}),a.jsx(f,{onDoubleClick:s.onTrue,style:{width:T(e.phoneNumber)},sx:{whiteSpace:"nowrap"},children:e.phoneNumber}),a.jsx(f,{onDoubleClick:s.onTrue,style:{width:T(e.productName)},sx:{whiteSpace:"nowrap"},children:e.productName}),a.jsx(f,{onDoubleClick:s.onTrue,style:{width:T(e.faultDescription)},sx:{whiteSpace:"nowrap"},children:e.faultDescription}),a.jsx(f,{onDoubleClick:s.onTrue,style:{width:T(e.servicePersonnel)},sx:{whiteSpace:"nowrap"},children:e.servicePersonnel}),a.jsx(f,{onDoubleClick:s.onTrue,style:{width:T(e.invoiceUrl)},sx:{whiteSpace:"nowrap"},children:a.jsx(ne,{title:"Faturayı Görüntüle",placement:"top",arrow:!0,children:a.jsx($,{onClick:r.onTrue,children:a.jsx(I,{icon:"solar:eye-bold"})})})})]}),a.jsx(Ze,{currentCustomer:e,open:s.value,onClose:s.onFalse,userNamesFromQuick:u,operationPerformedList:i,fetchData:j}),a.jsxs(V,{open:r.value,onClose:r.onFalse,maxWidth:"md",fullWidth:!0,children:[a.jsx(Y,{children:"Fatura Görüntüleme"}),a.jsx(q,{children:e.invoiceUrl?a.jsx("img",{src:e.invoiceUrl,alt:"Fatura",style:{width:"100%",maxHeight:"400px"}}):a.jsx("p",{children:"Fatura bulunamadı."})}),a.jsx(Q,{children:a.jsx(H,{onClick:r.onFalse,children:"Kapat"})})]})]})}const ea=sessionStorage.getItem(ie);let E=[];const aa=async()=>{try{E=(await _.get(N.usersListUserName,{headers:{Authorization:`Bearer ${ea}`}})).data}catch(e){console.error("error",e)}},sa=async()=>(E.length===0&&await aa(),E);function la({filters:e,options:t,onResetPage:o}){const p=X(),u=d.useCallback(i=>{o(),e.setState({name:i.target.value})},[e,o]),j=d.useCallback(i=>{const s=typeof i.target.value=="string"?i.target.value.split(","):i.target.value;o(),e.setState({role:s})},[e,o]);return a.jsxs(a.Fragment,{children:[a.jsxs(G,{spacing:2,alignItems:{xs:"flex-end",md:"center"},direction:{xs:"column",md:"row"},sx:{p:2.5,pr:{xs:2.5,md:1}},children:[a.jsxs(Me,{sx:{flexShrink:0,width:{xs:200,md:350}},children:[a.jsx(Ve,{htmlFor:"user-filter-role-select-label",children:"Servis Personeli"}),a.jsx(Ke,{fullWidth:!0,multiple:!0,value:e.state.role,onChange:j,input:a.jsx(He,{label:"ServisPersoneli"}),renderValue:i=>i.map(s=>s).join(", "),inputProps:{id:"user-filter-role-select-label"},MenuProps:{PaperProps:{sx:{maxHeight:240}}},children:t.roles.map(i=>a.jsxs(y,{value:i,children:[a.jsx(J,{disableRipple:!0,size:"small",checked:e.state.role.includes(i)}),i]},i))})]}),a.jsxs(G,{direction:"row",alignItems:"center",spacing:2,flexGrow:1,sx:{width:1},children:[a.jsx($e,{fullWidth:!0,value:e.state.name,onChange:u,placeholder:"Ara...",InputProps:{startAdornment:a.jsx(oe,{position:"start",children:a.jsx(I,{icon:"eva:search-fill",sx:{color:"text.disabled"}})})}}),a.jsx($,{onClick:p.onOpen,children:a.jsx(I,{icon:"eva:more-vertical-fill"})})]})]}),a.jsx(be,{open:p.open,anchorEl:p.anchorEl,onClose:p.onClose,slotProps:{arrow:{placement:"right-top"}}})]})}const ta=async()=>{try{const e=await _.get(N.customerListUrl);return Array.isArray(e.data)?e.data:[]}catch(e){return console.error("Müşteri listesini çekerken hata oluştu..",e),[]}};function na({filters:e,onResetPage:t,totalResults:o,sx:p}){const u=d.useCallback(()=>{t(),e.setState({name:""})},[e,t]),j=d.useCallback(()=>{t(),e.setState({status:"all"})},[e,t]),i=d.useCallback(r=>{const c=e.state.role.filter(x=>x!==r);t(),e.setState({role:c})},[e,t]),s=d.useCallback(()=>{t(),e.onResetState()},[e,t]);return a.jsxs(je,{totalResults:o,onReset:s,sx:p,children:[a.jsx(O,{label:"Servis Tamamlanma Durumu:",isShow:e.state.status!=="all",children:a.jsx(R,{...L,label:e.state.status,onDelete:j,sx:{textTransform:"capitalize"}})}),a.jsx(O,{label:"Servis Personeli:",isShow:!!e.state.role.length,children:e.state.role.map(r=>d.createElement(R,{...L,key:r,label:r,onDelete:()=>i(r)}))}),a.jsx(O,{label:"Keyword:",isShow:!!e.state.name,children:a.jsx(R,{...L,label:e.state.name,onDelete:u})})]})}const ia=[{value:"all",label:"Liste"},...K],w=e=>{const o=e.length*8;return Math.max(o,300)},oa=[{id:"id",label:"Servis Kayıt",width:w("Servis Kayıt")},{id:"customerFirstName",label:"Ad",width:w("Ad")},{id:"customerLastName",label:"Soyad",width:w("Soyad")},{id:"phoneNumber",label:"Telefon",width:w("Telefon")},{id:"productName",label:"Ürün Adı",width:w("Ürün Adı")},{id:"faultDescription",label:"Arıza Tanımı",width:w("Arıza Tanımı")},{id:"servicePersonnel",label:"Servis Personeli",width:w("Servis Personeli")},{id:"invoiceUrl",label:"Fatura",width:w("Fatura")},{id:"",label:"",width:w("")}];function ra(){const e=Se();re();const t=A(),[o,p]=d.useState([]),[u,j]=d.useState([]),[i,s]=d.useState([]),r=async()=>{const l=await ta(),g=l.flatMap(F=>F.operationPerformed||[]);s([...new Set(g)]),p(l)};d.useEffect(()=>{r()},[]),d.useEffect(()=>{(async()=>{const g=await sa();j(g)})()},[]);const c=de({customerFirstName:"",customerLastName:"",role:[],status:"all"}),x=da({inputData:o,comparator:ve(e.order,e.orderBy),filters:c.state});fe(x,e.page,e.rowsPerPage);const D=!!c.state.customerFirstName||!!c.state.customerLastName||c.state.role.length>0||c.state.status!=="all",k=!x.length&&D||!x.length,z=d.useCallback((l,g)=>{e.onResetPage(),c.setState({status:g})},[c,e]);return a.jsxs(a.Fragment,{children:[a.jsx(ce,{maxWidth:"xl",children:a.jsxs(P,{sx:{display:"flex",flexDirection:"column",alignItems:"flex-start",width:"100%"},children:[a.jsx(Ie,{heading:"Müşteri Teknik Servis Bilgileri",links:[{name:"Dashboard",href:he.dashboard.root},{name:"Teknik Servis Listesi"}],sx:{mb:{xs:3,md:5}}}),a.jsxs(Ee,{sx:{width:"100%",overflowX:"auto"},children:[a.jsx(Ye,{value:c.state.status,onChange:z,sx:{px:2.5,boxShadow:l=>`inset 0 -2px 0 0 ${me(l.vars.palette.grey["500Channel"],.08)}`},children:ia.map(l=>a.jsx(qe,{iconPosition:"end",value:l.value,label:l.label,icon:a.jsx(pe,{variant:(l.value==="all"||l.value===c.state.status)&&"filled"||"soft",color:l.value==="Kargoya_Verildi"&&"success"||l.value==="Talebiniz_Alındı"&&"info"||l.value==="Ürün_Teslim_Alındı"&&"info"||l.value==="işlem_Tamamlandı"&&"warning"||"default",children:["Kargoya_Verildi","Talebiniz_Alındı","Ürün_Teslim_Alındı","işlem_Tamamlandı"].includes(l.value)?o.filter(g=>g.serviceCompletionStatus===l.value).length:o.length})},l.value))}),a.jsx(la,{filters:c,onResetPage:e.onResetPage,options:{roles:u}}),D&&a.jsx(na,{filters:c,totalResults:x.length,onResetPage:e.onResetPage,sx:{p:2.5,pt:0}}),a.jsxs(P,{sx:{position:"relative"},children:[a.jsx(we,{dense:e.dense,numSelected:e.selected.length,rowCount:x.length,onSelectAllRows:l=>e.onSelectAllRows(l,x.map(g=>g.id))}),a.jsx(P,{sx:{position:"relative",height:"500px",display:"flex",justifyContent:"flex-start",width:"100%",overflowX:"auto"},children:a.jsx(xe,{children:a.jsxs(Te,{size:e.dense?"small":"medium",sx:{minWidth:1500,width:"100%"},children:[a.jsx(ye,{order:e.order,orderBy:e.orderBy,headLabel:oa,rowCount:x.length,numSelected:e.selected.length,onSort:e.onSort,onSelectAllRows:l=>e.onSelectAllRows(l,x.map(g=>g.id))}),a.jsxs(Pe,{children:[x.slice(e.page*e.rowsPerPage,e.page*e.rowsPerPage+e.rowsPerPage).map(l=>a.jsx(Ce,{fetchData:r,row:l,selected:e.selected.includes(l.id),onSelectRow:()=>e.onSelectRow(l.id),userNames:u,operationPerformedList:i},l.id)),a.jsx(Ae,{height:e.dense?56:76,emptyRows:Ne(e.page,e.rowsPerPage,x.length)}),a.jsx(De,{notFound:k})]})]})})})]}),a.jsx(ke,{page:e.page,dense:e.dense,count:x.length,rowsPerPage:e.rowsPerPage,onPageChange:e.onChangePage,onChangeDense:e.onChangeDense,onRowsPerPageChange:e.onChangeRowsPerPage})]})]})}),a.jsx(Fe,{open:t.value,onClose:t.onFalse})]})}function da({inputData:e,comparator:t,filters:o}){const{role:p,name:u,status:j}=o;if(!Array.isArray(e))return console.error("inputData is not an array:",e),[];const i=e.map((s,r)=>[s,r]);return i.sort((s,r)=>{const c=t(s[0],r[0]);return c!==0?c:s[1]-r[1]}),e=i.map(s=>s[0]),p.length&&(e=e.filter(s=>p.includes(s.servicePersonnel))),u&&(e=e.filter(s=>s.customerFirstName.toLowerCase().indexOf(u.toLowerCase())!==-1)),j!=="all"&&(e=e.filter(s=>s.serviceCompletionStatus===j)),e}const ca={title:`Müşteri Servis Listesi | Dashboard - ${N.appName}`};function ua(){return a.jsxs(a.Fragment,{children:[a.jsx(ue,{children:a.jsx("title",{children:ca.title})}),a.jsx(ra,{})]})}export{ua as default};
